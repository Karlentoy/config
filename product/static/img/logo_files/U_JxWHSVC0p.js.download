;/*FB_PKG_DELIM*/

__d("PolarisMediaTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a={CAROUSEL:"carousel",CAROUSEL_VIDEO:"carousel_video",IGTV:"igtv",PHOTO:"photo",VIDEO:"video"};c=b("$InternalEnum")({VIDEO_640_HIGH:101,VIDEO_480_HIGH:102,VIDEO_480_LOW:103});d=b("$InternalEnum")({LIVE:"live",FEED:"feed",STORY:"story",DIRECT:"direct",IGTV:"igtv",NAMETAG:"nametag",DIRECT_AUDIO:"direct_audio",CAROUSEL_ITEM:"carousel_item",CAROUSEL_CONTAINER:"carousel_container",PROFILE_PIC:"profile_pic",AD:"ad",AR_EFFECT_PREVIEW:"ar_effect_preview",DIRECT_PERMANENT:"direct_permanent",SELFIE_STICKER:"selfie_sticker",COWATCH_LOCAL:"cowatch_local",CLIPS:"clips",GUIDE_MEDIA_FACADE:"guide_media_facade",FUNDRAISER_COVER:"fundraiser_cover",LIVE_ARCHIVE:"live_archive",HIGHLIGHT_POST_FACADE:"highlight_post_facade",DIRECT_THREAD:"direct_thread",SCHEDULED_LIVE:"scheduled_live",RATINGS_AND_REVIEWS:"ratings_and_reviews",DIRECT_HEADMOJI:"direct_headmoji",CLIPS_PREVIEW:"clips_preview",REPOST_MEDIA_FACADE:"repost_media_facade",STORY_INTERACTION_RESPONSE:"story_interaction_response",MEDIA_KIT:"media_kit",TEXT_POST:"text_post",NOTE_AUDIO:"note_audio",DIRECT_MESSAGE_COMMENT_FACADE:"direct_message_comment_facade"});f.SimplifiedMediaType=a;f.MediaVersionType=c;f.MediaProductType=d}),66);
__d("IGDThreadTTLCUtils",["IGDInstamadilloUtils","LSThreadBitOffset","PolarisMediaTypes","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a==null||d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a))return!1;return!c("qex")._("954")?!1:d("LSThreadBitOffset").has(b,a)}function a(a){return h(a,225)}function b(a){return h(a,235)}function e(a){return h(a,226)}function f(a){return h(a,227)}function i(a){return h(a,228)}function j(a){return h(a,229)}function k(a){return h(a,230)}function l(a){return h(a,231)}function m(a){return h(a,232)}function n(a){return h(a,233)}function o(a){return h(a,234)}function p(a,b){var e=a.isDisappearingModeSettingOn,f=a.isTTLCClipEnabled,g=a.isTTLCGenericXMAShareEnabled,h=a.isTTLCMediaShareEnabled;a=a.isTTLCStoryShareEnabled;b=d("PolarisMediaTypes").MediaProductType.cast(b);if(b==null||e)return!1;if(!c("qex")._("954"))return!1;switch(b){case d("PolarisMediaTypes").MediaProductType.FEED:case d("PolarisMediaTypes").MediaProductType.CAROUSEL_CONTAINER:case d("PolarisMediaTypes").MediaProductType.AD:return h;case d("PolarisMediaTypes").MediaProductType.CLIPS:return f;case d("PolarisMediaTypes").MediaProductType.STORY:return a;case d("PolarisMediaTypes").MediaProductType.LIVE:return g;default:return!1}}g.isInstamadilloTTLCTextEnabled=a;g.isInstamadilloTTLCCallingEnabled=b;g.isInstamadilloTTLCClipEnabled=e;g.isInstamadilloTTLCReelShareEnabled=f;g.isInstamadilloTTLCMediaShareEnabled=i;g.isInstamadilloTTLCStoryShareEnabled=j;g.isInstamadilloTTLCLinkEnabled=k;g.isInstamadilloTTLCGenericXmaEnabled=l;g.isInstamadilloTTLCImageEnabled=m;g.isInstamadilloTTLCVideoEnabled=n;g.isInstamadilloTTLCAudioEnabled=o;g.isIGDTTLCEnabledForIGDCandidate=p}),98);
__d("IGDGetMessagePluginInfo",["IGDInstamadilloUtils","LSIntEnum","LSPendingTasksPluginType","asyncToGeneratorRuntime","isInstamadillo"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return b?i(a,b):c()}function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!c("isInstamadillo")())return{openEb:!1,pluginType:void 0};var e=(yield a.messages.index("messageId").get(b.messageId));if(!d("IGDInstamadilloUtils").isInstamadilloMessage(e))return{openEb:!1,pluginType:void 0};e=(yield a.e2ee_igMessageAuxiliaryInfo.get(b.messageId));a=Boolean(e==null?void 0:e.openEb);return{openEb:a,pluginType:(h||(h=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO)}});return j.apply(this,arguments)}g.IGDGetMessagePluginInfo=a}),98);
__d("MessagingLoggingUtils",["I64","MessagingAttachmentType"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=(h||(h=d("I64"))).to_int32(a);switch(a){case c("MessagingAttachmentType").NONE:return 1;case c("MessagingAttachmentType").STICKER:return 4;case c("MessagingAttachmentType").IMAGE:return 8;case c("MessagingAttachmentType").ANIMATED_IMAGE:return 6;case c("MessagingAttachmentType").VIDEO:return 10;case c("MessagingAttachmentType").AUDIO:return 11;case c("MessagingAttachmentType").FILE:return 9;case c("MessagingAttachmentType").XMA:return 13;case c("MessagingAttachmentType").EPHEMERAL_IMAGE:return 8;case c("MessagingAttachmentType").EPHEMERAL_VIDEO:return 5;case c("MessagingAttachmentType").SELFIE_STICKER:return 22;case c("MessagingAttachmentType").SOUND_BITE:return 23;default:return 1}}g.convertI64ToAttachmentType=a}),98);
__d("MWMediaTraceHandler",["I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSDataTraceType","LSFactory","LSIntEnum","MAWTimeUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return a.data_trace_meta.add({contextOne:void 0,contextThree:void 0,contextTwo:void 0,foregroundTimestampMs:(h||(h=d("I64"))).zero,initTimestampMs:d("MAWTimeUtils").toTimestamp(d("WATimeUtils").unixTime()),predefinedId:void 0,shouldFlush:!1,traceId:b,traceType:(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").TASK)})}function a(a,b,e,f){return j(a,b).then(function(){return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").RICH_MEDIA_UPLOAD_START),dataTraceId:b,syncChannel:(h||(h=d("I64"))).neg_one,tags:h.to_string(e)+","+h.to_string(f)})})}g.logMediaSendStart=a}),98);
__d("MWV2SetupS2SLoggingShared",["I64","LSIntEnum","MWChatInteraction","MWLSLogSend","MWVersion","ReQL","ReQLSubscribe","asyncToGeneratorRuntime","err","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){d("sendToSentQPLLogger").markSendToSentPoint(a,"received_successful_server_ack"),d("sendToSentQPLLogger").markSendToSentSuccess(a),d("MWChatInteraction").remove(d("MWChatInteraction").s2sKey(b))}function k(a,b){d("sendToSentQPLLogger").markSendToSentFail(a,c("err")("fail_to_send_message")),d("MWChatInteraction").remove(d("MWChatInteraction").s2sKey(b))}function l(a){d("sendToSentQPLLogger").markSendToSentPoint(a,"sending_message")}function a(a){var c=a.db,e=a.initiatingSource,f=a.isCommunityEvent,g=a.isMessageRequest,m=a.s2sInstanceKey,n=a.threadType,o=a.traceSendMessageAPI,p={initiatingSource:e,isCommunityEvent:f,isMessageRequest:g,mwVersion:d("MWVersion").v2,threadType:n};return function(a){d("MWLSLogSend").logSentHeroInteraction(o,a,p);d("MWChatInteraction").set(d("MWChatInteraction").s2sKey(a),String(m));d("sendToSentQPLLogger").addSendToSentAnnotations(m,{string:babelHelpers["extends"]({},d("MWLSLogSend").getMessageSendAnnotations(p))});d("sendToSentQPLLogger").addSendToSentAnnotations(m,{bool:{subscription_points_gk:!0}});var e=!1,f=d("ReQL").fromTableAscending(c.tables.messages.index("optimistic")).getKeyRange(a),g=d("ReQLSubscribe").subscribeToFirst(f,function(b){b!=null&&(h||(h=d("I64"))).equal(b.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(2))?(e=!0,j(m,a),g()):b!=null&&(h||(h=d("I64"))).equal(b.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(4))?(e=!0,k(m,a),g()):b!=null&&(h||(h=d("I64"))).equal(b.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(1))&&l(m)});window.setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!e){var a=(yield d("ReQL").firstAsync(f));e||d("sendToSentQPLLogger").addSendToSentAnnotations(m,{string:{status_after_10s:a?""+(i||(i=d("LSIntEnum"))).toNumber(a.sendStatusV2):"none"}})}}),1e4);window.setTimeout(function(){g()},6e4)}}g["default"]=a}),98);
__d("issueLSAudioMediaSendJob",["I64","LSDatabaseSingletonLazyWrapper","LSFactory","LSInsertNewMediaSendStoredProcedure","LSMarkSubJobCompletedV2StoredProcedure","MWPComposerMediaUploadUtil","MWPOpenComposerUtils","ReQL","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,e){if(a==null)return;if(!a.startsWith("blob:"))return;var f={contents:function(){}};f.contents=d("ReQL").fromTableAscending(c.tables.attachments).getKeyRange(e).subscribe(function(c,d){if(d.operation==="put"){c=d.value;if(c.attachmentFbid!==b.toString())return;d=c.playableUrl;d!=null&&!d.startsWith("blob:")&&(f.contents(),URL.revokeObjectURL(a))}})}function a(a,b,c,d,e,f,g,h,i,k,l){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j,k,l,m,n,o,p){yield c("LSInsertNewMediaSendStoredProcedure")(c("LSFactory")(a),{attachmentType:l.attachment_type,inMessageIndex:(h||(h=d("I64"))).zero,isSecure:!1,offlineAttachmentId:j,offlineThreadingId:k,sendByServer:!1,shouldTranscode:!1,useDoublePhase:!1});a=function(a,f){if(f==null)return;var m=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("LSDatabaseSingletonLazyWrapper")());return a.runInTransaction(function(){var m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=c("LSFactory")(b);yield c("LSMarkSubJobCompletedV2StoredProcedure")(b,{fbid:(h||(h=d("I64"))).of_float(f),offlineAttachmentId:j});yield d("MWPOpenComposerUtils").resumeSendJob(b,k,g);i(l.playable_url,f,a,e)});return function(a){return m.apply(this,arguments)}}(),"readwrite")});return function(){return a.apply(this,arguments)}}();c("promiseDone")(m(),function(){o==null?void 0:o(a)})};var q=function(a,b){p==null?void 0:p((b=b.response.getErrorDescriptionString())!=null?b:"unknown_upload_failure",a)};d("MWPComposerMediaUploadUtil").startUpload(n,void 0,a,q,!0,[m.file],[j],void 0,void 0,m.waveformData,void 0,h.to_string(f))});return j.apply(this,arguments)}g["default"]=a}),98);
__d("issueLSMediaSendJobs",["ArmadilloDataTraceCheckPoint","I64","LSAppendDataTraceAddonStoredProcedure","LSFactory","LSGenerateTraceId","LSInsertNewMediaSendStoredProcedure","LSMarkSubJobCompletedV2StoredProcedure","MWConsole","MWMediaTraceHandler","MWPOpenComposerUtils","MessagingLoggingUtils","Promise","asyncToGeneratorRuntime","gkx","updateAndFlushLSDataTrace"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){b!=null&&(yield d("MWMediaTraceHandler").logMediaSendStart(a,b,c,(i||(i=d("I64"))).of_int32(e)))});return k.apply(this,arguments)}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e!=null&&c("gkx")("23995")&&(yield c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").armadilloTlcControlOpenThread,dataTraceId:e,syncChannel:(i||(i=d("I64"))).minus_one,tags:b}))});return m.apply(this,arguments)}function a(a,b,c,d,e){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k){var m=c("LSGenerateTraceId")(),n=k[0];n=d("MessagingLoggingUtils").convertI64ToAttachmentType(n.attachmentType);yield j(a,m,(i||(i=d("I64"))).of_int32(g.length),n);var o=0;n=g.map(function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,g){yield c("LSInsertNewMediaSendStoredProcedure")(c("LSFactory")(a),{attachmentType:b.attachment_type,inMessageIndex:(i||(i=d("I64"))).of_int32(g),isSecure:!1,offlineAttachmentId:b.attachment_fbid,offlineThreadingId:f,sendByServer:!1,shouldTranscode:!1,useDoublePhase:!1});yield d("MWPOpenComposerUtils").updateMediaStaging(a,b.attachment_fbid,function(a){return babelHelpers["extends"]({},a,{isSent:!0})});g=k.find(function(a){return a.offlineAttachmentId===b.offline_attachment_id});if(g!=null){var h=g.fbid;h!=null&&(yield c("LSMarkSubJobCompletedV2StoredProcedure")(c("LSFactory")(a),{fbid:h,offlineAttachmentId:b.attachment_fbid}),yield d("MWPOpenComposerUtils").deleteMediaStaging(a,b.attachment_fbid),yield d("MWPOpenComposerUtils").updateAttachment(a,e,f,b.attachment_fbid,function(a){return babelHelpers["extends"]({},a,{attachmentFbid:(i||(i=d("I64"))).to_string(h)})}),o++)}c("gkx")("24136")&&(yield d("MWPOpenComposerUtils").updateAttachment(a,e,f,b.attachment_fbid,function(a){return babelHelpers["extends"]({},a,{previewHeight:void 0,previewWidth:void 0})}))});return function(a,b){return g.apply(this,arguments)}}());yield (h||(h=b("Promise"))).allSettled(n);yield d("MWPOpenComposerUtils").resumeSendJob(c("LSFactory")(a),f,m);yield l(a,i.to_string(e),m);yield c("updateAndFlushLSDataTrace")(a,m);return{sentWithAllFilesUploaded:o===g.length}});return n.apply(this,arguments)}g["default"]=a}),98);
__d("issueSendInstamadilloMediaMessageCometTask",["CometTaskFramework","MAWCurrentUser","MWPOpenComposerUtils","Promise","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("promiseDone")(c("CometTaskFramework")(d("MAWCurrentUser").getID()).issueTask("igd_send_media_message",{offlineThreadingId:f}));f=e.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("MWPOpenComposerUtils").updateMediaStaging(a,b.attachment_fbid,function(a){return babelHelpers["extends"]({},a,{isSent:!0})})});return function(a){return c.apply(this,arguments)}}());yield (h||(h=b("Promise"))).allSettled(f)});return i.apply(this,arguments)}g["default"]=a}),98);
__d("useMWV2SendOpenMessageImplShared",["ArmadilloDataTraceCheckPoint","I64","IGDGetMessagePluginInfo","IGDThreadTTLCUtils","Int64Hooks","LSAppendDataTraceAddonStoredProcedure","LSAuthorityLevel","LSFactory","LSIntEnum","LSMailboxType","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSOptimisticSendMessageV2StoredProcedure","LSPendingTasksPluginType","LSShape","MWPActor.react","MWPReplyContext.react","MessagePowerUp","asyncToGeneratorRuntime","gkx","react","useLSMessagingInitiatingSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h||d("react")).useContext;function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e!=null&&c("gkx")("23995")&&(yield c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").armadilloTlcControlOpenThread,dataTraceId:e,syncChannel:(i||(i=d("I64"))).minus_one,tags:b}))});return m.apply(this,arguments)}function a(a){var e=a.authorityLevel,f=a.disableMarkRead,g=a.ephemeralDurationInSec,h=a.onOptimisticMessageCreation,m=a.skipUrlPreviewGen,n=a.threadKey,o=a.threadType,p=d("MWPActor.react").useActor();a=k(d("MWPReplyContext.react").MWPReplyContext);var q=a.reply,r=c("useLSMessagingInitiatingSource")();return d("Int64Hooks").useCallbackInt64(function(a){var k=a.afterSend,s=a.attributionAppId,t=a.dataTraceId,u=a.externalAttachmentUrl,v=a.hotEmojiSize,w=a.logSendPoint,x=a.mentionData,y=a.messageText,z=a.messageTypeParams,A=a.multitabEnv,B=a.optimisticAttachmentPreview,C=a.platformToken,D=a.pluginType,E=a.profileRanges,F=a.richTextFormatType,G=a.s2sInstanceKey,H=a.setupS2SLogging,I=a.source,J=a.stickerID,K=a.transaction;return L(K);function L(a){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var L=c("LSFactory")(a),M=c("gkx")("24135");yield l(a,(i||(i=d("I64"))).to_string(n),t);var N=z.hasAttachment,O=z.hasGif,P=z.hasLinks,Q=z.hasSticker,R=z.hasText,S=(yield d("IGDGetMessagePluginInfo").IGDGetMessagePluginInfo(a,q,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield a.threads.get(n));b=P?d("IGDThreadTTLCUtils").isInstamadilloTTLCLinkEnabled(b):d("IGDThreadTTLCUtils").isInstamadilloTTLCTextEnabled(b);return{openEb:b,pluginType:b?(j||(j=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):D}}))),T=S.openEb;S=S.pluginType;L=(yield c("LSOptimisticSendMessageV2StoredProcedure")(L,{extraSendMessageParams:d("LSShape").ofRecord({attribution_app_id:s,calculate_denormalizations:!1,data_trace_id:(L=t)!=null?L:void 0,ephemeral_duration_in_sec:g,external_attachment_url:u,hot_emoji_size:v,initiating_source:r,mark_read:f===!0?!1:(i||(i=d("I64"))).ge(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)),mention_data:x,multitab_env:A,openEb:T,optimistic_attachment_preview:B,platform_token:C,plugin_type:S,power_up_style:(j||(j=d("LSIntEnum"))).ofNumber(c("MessagePowerUp").NONE),qpl_instance_key:G==null?void 0:G.toString(),reply_source_id:q==null?void 0:q.messageId,reply_source_type:q!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceType").MESSAGE):void 0,reply_source_type_v2:q!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE):void 0,rich_text_format_type:F,skip_url_preview_gen:m,source:I,sticker_id:J,text_has_links:P&&M}),mailboxType:j.ofNumber(c("LSMailboxType").MESSENGER),senderId:p,text:y,threadKey:n,threadType:o}));w("create_optimistic_message_success");if(!N){T=L[0];H(T)}h!=null&&h({TAG:0,hasLink:P,hasMention:E!=null&&E.length>0,isGIF:O,isReply:!!(q&&q.messageId!==""),isSticker:Q,isText:R,offlineThreadingId:L[0]});k!=null&&(yield k(K));return L});return M.apply(this,arguments)}},[n,g,r,e,q,m,p,o,h])}g["default"]=a}),98);
__d("useMWV2SendOpenMessageImpl",["useMWV2SendOpenMessageImplShared"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.disableMarkRead,d=a.ephemeralDurationInSec,e=a.onOptimisticMessageCreation,f=a.skipUrlPreviewGen;a=a.thread;return c("useMWV2SendOpenMessageImplShared")({authorityLevel:a.authorityLevel,disableMarkRead:b,ephemeralDurationInSec:d,onOptimisticMessageCreation:e,skipUrlPreviewGen:f,threadKey:a.threadKey,threadType:a.threadType})}g["default"]=a}),98);
__d("MWPSendMessageLogger",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MWLogSend").__setRef("MWPSendMessageLogger");function a(a,b,c,d,e,f,g,i,j){h.onReady(function(h){return h.log({actor:c,attachmentFbids:e,attachmentType:g,backend:0,ephemeralDurationInSec:j,hasReply:i,offlineThreadingId:d,sendType:0,source:f,threadKey:a,threadType:b})})}g.log=a}),98);
__d("useMWV2SendOpenStagedMedia",["I64","IGDGetMessagePluginInfo","IGDThreadTTLCUtils","Int64Hooks","LSFactory","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSMessagingThreadTypeUtil","LSPendingTasksPluginType","LSShape","LSThreadBitOffset","LSVec","MWConsole","MWPActor.react","MWPComposerMediaUploadUtil","MWPReplyContext.react","MWPSendMessageLogger","MessagingAttachmentType","MessagingLoggingUtils","MessengerWebEventsFalcoEvent","Promise","asyncToGeneratorRuntime","issueLSMediaSendJobs","issueSendInstamadilloMediaMessageCometTask","react","useLSMessagingInitiatingSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(k||d("react")).useContext;function a(a,e,f){var g=d("MWPActor.react").useActor(),k=l(d("MWPReplyContext.react").MWPReplyContext),m=k.reply,n=c("useLSMessagingInitiatingSource")(),o=d("LSThreadBitOffset").has(40,f),p=d("IGDThreadTTLCUtils").isInstamadilloTTLCImageEnabled(f)||d("IGDThreadTTLCUtils").isInstamadilloTTLCVideoEnabled(f);return d("Int64Hooks").useCallbackInt64(function(){var k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(k){var l=k.isFirstMessage;l=l===void 0?!1:l;var q=k.isFirstMessageText,r=k.mediaStagings,s=k.pluginType,t=k.sendFirstMessageSeparately;t=t===void 0?!1:t;var u=k.setupS2SLogging,v=k.source;k=k.transaction;if(r.length===0){d("MWPSendMessageLogger").log(f.threadKey,f.threadType,g,void 0,[],v,c("MessagingAttachmentType").NONE,m!=null,a);return}var w=(yield d("IGDGetMessagePluginInfo").IGDGetMessagePluginInfo(k,m,function(){return(h||(h=b("Promise"))).resolve({openEb:p,pluginType:p?(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):s})}));w=w.pluginType;var x=r[0];x=d("MessagingLoggingUtils").convertI64ToAttachmentType(x.attachmentType);var y=d("MWPComposerMediaUploadUtil").createPartitionedAttachments(r,o),z=!0;for(var A=0;A<y.length;A++)if(!l||!t||A===0&&l&&!q){var B=y[A],C=(yield c("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure")(c("LSFactory")(k),{extraSendMessageParams:d("LSShape").ofRecord({attachments:c("LSVec").ofArray(B.map(d("LSShape").ofRecord)),ephemeral_duration_in_sec:a,external_attachment_url:void 0,initiating_source:n,mark_read:!1,platform_ref:void 0,platform_token:void 0,plugin_type:w,reply_source_id:m==null?void 0:m.messageId,reply_source_type:m!=null?(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceType").MESSAGE):void 0,reply_source_type_v2:m!=null?(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE):void 0,source:v}),senderId:g,threadKey:f.threadKey,threadType:f.threadType}));C=C[0];A===0&&u(C);yield k.messages_optimistic_context.add({externalAttachmentUrl:void 0,initiatingSource:n,markThreadRead:!1,messageId:void 0,offlineThreadingId:C,platformRef:void 0,platformToken:void 0,replySourceId:void 0,replySourceType:void 0,sendType:void 0,skipUrlPreviewGen:void 0,taskId:(j||(j=d("I64"))).of_string(C),threadAttributionSource:v,threadKey:f.threadKey});e==null?void 0:e({TAG:2,numberOfAttachments:B.length,offlineThreadingId:C});if(w!=null&&(i||(i=d("LSIntEnum"))).unwrapIntEnum(w)===c("LSPendingTasksPluginType").IGD_INSTAMADILLO)yield c("issueSendInstamadilloMediaMessageCometTask")(k,B,C);else{var D=(yield c("issueLSMediaSendJobs")(k,f.threadKey,C,B,r));z=z&&D.sentWithAllFilesUploaded}d("MWPSendMessageLogger").log(f.threadKey,f.threadType,g,C,B.map(function(a){return a.attachment_fbid}),v,x,m!=null,a)}D=(j||(j=d("I64"))).to_string(f.threadKey);C=d("LSMessagingThreadTypeUtil").isGroup(f.threadType)?[D,null]:[null,D];var E=C[0],F=C[1];c("MessengerWebEventsFalcoEvent").log(function(){return{event_name:z?"hit_send_message_with_all_files_uploaded":"hit_send_message_with_files_pending",extra_data:null,other_user_fbid:F,thread_fbid:E}})});return function(a){return k.apply(this,arguments)}}(),[p,o,f.threadKey,f.threadType,g,m,a,n,e])}g["default"]=a}),98);
__d("useMWV2SendOpenVoiceClipImplShared",["I64","IGDGetMessagePluginInfo","IGDThreadTTLCUtils","Int64Hooks","LSFactory","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSPendingTasksPluginType","LSShape","LSVec","MWMediaTraceHandler","MWPActor.react","MWPComposerMediaUploadUtil","MWPReplyContext.react","MessagingLoggingUtils","OfflineThreadingId","Promise","asyncToGeneratorRuntime","issueLSAudioMediaSendJob","issueSendInstamadilloMediaMessageCometTask","react","useLSMessagingInitiatingSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(i||d("react")).useContext;function m(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){b!=null&&(yield d("MWMediaTraceHandler").logMediaSendStart(a,b,c,(k||(k=d("I64"))).of_int32(e)))});return n.apply(this,arguments)}function a(a){var e=a.ephemeralDurationInSec,f=a.onOptimisticMessageCreation,g=a.onUploadFailure,i=a.onUploadStart,n=a.onUploadSuccess,o=a.sendMessageLogger,p=a.skipUrlPreviewGen,q=a.threadKey,r=a.threadType,s=d("MWPActor.react").useActor();a=l(d("MWPReplyContext.react").MWPReplyContext);var t=a.reply,u=c("useLSMessagingInitiatingSource")();return d("Int64Hooks").useCallbackInt64(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var l=a.dataTraceId,v=a.pluginType,w=a.setupS2SLogging,x=a.source,y=a.transaction;a=a.voiceClip;var z=c("LSFactory")(y),A=d("OfflineThreadingId").createOfflineThreadingID(),B=d("MWPComposerMediaUploadUtil").getAudioAttachment(A,a.file,a.duration,a.waveformData);yield m(y,l,(k||(k=d("I64"))).one,2);var C=(yield d("IGDGetMessagePluginInfo").IGDGetMessagePluginInfo(y,t,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield y.threads.get(q));a=d("IGDThreadTTLCUtils").isInstamadilloTTLCAudioEnabled(a);return(h||(h=b("Promise"))).resolve({openEb:a,pluginType:a?(j||(j=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):v})})));C=C.pluginType;z=(yield c("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure")(z,{extraSendMessageParams:d("LSShape").ofRecord({attachments:c("LSVec").ofArray([d("LSShape").ofRecord(B)]),ephemeral_duration_in_sec:e,external_attachment_url:void 0,initiating_source:u,mark_read:!1,platform_ref:void 0,platform_token:void 0,plugin_type:C,reply_source_id:t==null?void 0:t.messageId,reply_source_type:t!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceType").MESSAGE):void 0,reply_source_type_v2:t!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE):void 0,source:x}),senderId:s,threadKey:q,threadType:r}));z=z[0];w(z);yield y.messages_optimistic_context.add({externalAttachmentUrl:void 0,initiatingSource:u,markThreadRead:!1,messageId:void 0,offlineThreadingId:z,platformRef:void 0,platformToken:void 0,replySourceId:void 0,replySourceType:void 0,sendType:void 0,skipUrlPreviewGen:p,taskId:k.of_string(z),threadAttributionSource:x,threadKey:q});f!=null&&f({TAG:1,offlineThreadingId:z});C!=null&&(j||(j=d("LSIntEnum"))).unwrapIntEnum(C)===c("LSPendingTasksPluginType").IGD_INSTAMADILLO?yield c("issueSendInstamadilloMediaMessageCometTask")(y,[B],z):yield c("issueLSAudioMediaSendJob")(y,q,s,l,A,z,B,a,i,n,g);o({actor:s,attachmentFbids:[B.attachment_fbid],attachmentType:d("MessagingLoggingUtils").convertI64ToAttachmentType(B.attachment_type),hasReply:t!=null,key:q,offlineThreadingId:z,source:x,type:r})});return function(b){return a.apply(this,arguments)}}(),[q,e,u,t,s,r,p,f,o,i,n,g])}g["default"]=a}),98);
__d("useMWV2SendOpenVoiceClip",["Int64Hooks","MWPSendMessageLogger","useMWV2SendOpenVoiceClipImplShared"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.ephemeralDurationInSec,e=a.onOptimisticMessageCreation,f=a.onUploadFailure,g=a.onUploadStart,h=a.onUploadSuccess,i=a.skipUrlPreviewGen;a=a.thread;var j=d("Int64Hooks").useCallbackInt64(function(a){var c=a.actor,e=a.attachmentFbids,f=a.attachmentType,g=a.hasReply,h=a.key,i=a.offlineThreadingId,j=a.source;a=a.type;c!=null&&d("MWPSendMessageLogger").log(h,a,c,i,e,j,f,g,b)},[b]);return c("useMWV2SendOpenVoiceClipImplShared")({ephemeralDurationInSec:b,onOptimisticMessageCreation:e,onUploadFailure:f,onUploadStart:g,onUploadSuccess:h,sendMessageLogger:j,skipUrlPreviewGen:i,threadKey:a.threadKey,threadType:a.threadType})}g["default"]=a}),98);
__d("useMWV2SendOpenMessage",["I64","Int64Hooks","LSGenerateTraceId","LSMessagingThreadTypeUtil","LSShape","MWPReplyContext.react","MWSharedMsgLogUtils","MWV2ComposerActionsContext.react","MWV2SetupS2SLoggingShared","MultipleTabsLogger","ReQL","asyncToGeneratorRuntime","gkx","hasDefaultThreadOneToOneCapability","react","sendToSentQPLLogger","useAsyncReStore","useLSMessagingInitiatingSource","useMWLSDefaultThreadSource","useMWV2SendOpenMessageImpl","useMWV2SendOpenStagedMedia","useMWV2SendOpenVoiceClip"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useContext;function a(a){var e=a.disableMarkRead,f=a.ephemeralDurationInSec,g=a.onOptimisticMessageCreation,h=a.onUploadFailure,k=a.onUploadStart,l=a.onUploadSuccess,m=a.pluginType,n=a.skipUrlPreviewGen,o=a.thread,p=c("useAsyncReStore")();a=j(d("MWPReplyContext.react").MWPReplyContext);var q=a.reply,r=c("useLSMessagingInitiatingSource")(),s=c("useMWLSDefaultThreadSource")(),t=c("useMWV2SendOpenVoiceClip")({ephemeralDurationInSec:f,onOptimisticMessageCreation:g,onUploadFailure:h,onUploadStart:k,onUploadSuccess:l,skipUrlPreviewGen:n,thread:o}),u=c("useMWV2SendOpenStagedMedia")(f,g,o),v=c("useMWV2SendOpenMessageImpl")({disableMarkRead:(a=e)!=null?a:!1,ephemeralDurationInSec:f,onOptimisticMessageCreation:g,skipUrlPreviewGen:n,thread:o}),w=d("LSMessagingThreadTypeUtil").isMessageRequest(o);h=j(d("MWV2ComposerActionsContext.react").MWV2ComposerActionsContext);var x=h.onMessageSendAttempt;return d("Int64Hooks").useCallbackInt64(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,h,j,k,l,n,y,z,A,B,C,D,E){z===void 0&&(z=!1);A===void 0&&(A=!1);var F=!1;x==null?void 0:x(!0);function G(a){B.addMarkerPoint(a,"AppTiming"),d("sendToSentQPLLogger").markSendToSentPoint(C,a)}var H=s(o.threadKey),I=c("LSGenerateTraceId")(),J={contents:1};D=o.eventStartTimestampMs!=null;var K=o.threadType,L=(yield p),M=c("MWV2SetupS2SLoggingShared")({db:L,initiatingSource:r,isCommunityEvent:D,isMessageRequest:w,s2sInstanceKey:C,threadType:K,traceSendMessageAPI:B});if(c("gkx")("24121")){D=(yield c("hasDefaultThreadOneToOneCapability")(o.threadKey,L));D&&(G("invalid_send_to_default_e2ee"),d("sendToSentQPLLogger").addSendToSentAnnotations(C,{string:{invalid_send_to_default_e2ee_attribution:(i||(i=d("I64"))).to_string(H)}}))}var N=d("MWSharedMsgLogUtils").getMessageTypeParams(a,g,q,f,j,l,yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(L.tables.media_staging).filter(function(a){return!a.isSent&&(i||(i=d("I64"))).equal(a.threadKey,o.threadKey)}))),O=(yield d("MWSharedMsgLogUtils").getSendToSentAnnotations(o,N,r)),P=(yield d("MultipleTabsLogger").hasMultipleTabs());return L.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){d("MWSharedMsgLogUtils").addSendMessageMetadataForInteractionTrace(B,N,o,r);d("sendToSentQPLLogger").addSendToSentAnnotations(C,O);if(l!=null){(z===!1||A===!0)&&(yield t({dataTraceId:I,pluginType:m,setupS2SLogging:M,source:H,transaction:b,voiceClip:l}));return}var c=N.hasGif,p=N.hasSticker,q=N.hasText;p?J.contents=4:c&&(J.contents=6);var s=e!=null?d("LSShape").ofRecord({mention_ids:e.map(function(a){return a.id}).join(","),mention_lengths:e.map(function(a){return String(a.length)}).join(","),mention_offsets:e.map(function(a){return String(a.offset)}).join(","),mention_types:e.length!==0?e.map(function(a){return a.type}).join(","):void 0}):void 0;G("before_create_optimistic_message");if(q||p||c){F=!0;if(z===!1||A===!0){yield v({afterSend:y,attributionAppId:h,dataTraceId:I,externalAttachmentUrl:j,hotEmojiSize:g,logSendPoint:G,mentionData:s,messageText:a,messageTypeParams:N,multitabEnv:P,optimisticAttachmentPreview:k,platformToken:n,pluginType:m,profileRanges:e,richTextFormatType:E,s2sInstanceKey:C,setupS2SLogging:M,source:H,stickerID:f,transaction:b});if(z===!0)return}}else y!=null&&(yield y(b));!p&&!c&&(yield u({isFirstMessage:A,isFirstMessageText:F,mediaStagings:yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.media_staging).filter(function(a){return!a.isSent&&(i||(i=d("I64"))).equal(a.threadKey,o.threadKey)})),pluginType:m,sendFirstMessageSeparately:z,setupS2SLogging:M,source:H,transaction:b}))});return function(a){return c.apply(this,arguments)}}(),"readwrite","ui")});return function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a.apply(this,arguments)}}(),[x,s,o,p,r,w,q,t,v,u,m])}g["default"]=a}),98);